url = "insert_here";


function updateAll(entryNum){
  // Fetch the JSON data and console log it
  d3.json(url).then(function(data){
    console.log(data);

    // an empty list to add all the different states to
    let state_list = []
    let states = data.features.properties.state_id
    let aqi_values = data.features.properties.aqi

    //loops through all of the states and only adds the state if it is not already in the list
    for(i = 0; i < states.length; i++)
    {
        if(!(states[i] in state_list))
         {
             state_list.push(aqi_values[i])
         }
    }
    
    //empty list of aqi values
    let aqi_list = []

    //loops through all of the states
    for(x = 0; x < state_list; x++)
    {
        let aqi_average = 0;
        let aqi = 0;
        let count = 0;

        //loops through all of the data 
        for(i = 0; i < states.length; i++)
        {
            // if the state of the loop matches the state of the index of the state list which we made
            // then it will loop through and add the values to aqi_average to find the average for 
            // that particular state

            if(states[i] == state_list[x])
            {
                aqi_average = aqi_values[i] + aqi_average
                count = count + 1
            }
        }
        //pushes the average to the aqi_list
        aqi = (aqi_average/count)
        aqi_list.push(aqi)
    }
    //now we have a state list of all unique values and after looping through that, 
    //we have matching average aqi values at the same indices of the state list.


    ////////////////// Updates the Bar Chart ///////////////////////////
    let barData = [{
      x: state_list,
      y: aqi_list,
      type: "bar",
      orientation: "h",
    }];
    let barLayout = {
      yaxis:{
        type:'category',
        tickprefix: "Average AQI",
      }
    }
    Plotly.newPlot("bar", barData, barLayout);
})
}
function optionChanged(value) {
  updateAll(value)
}

function init() { 
  let data = d3.json(url).then(function(data){
    let dropBody = d3.select("#selDataset");

    for (i = 0; i < data.features.properties.aqi.length; i++) 
    {
      dropBody.append("option").attr("value", x).text(data[i].features.properties.aqi);
    }
  });
  updateAll(0);
  
}

init();